{% extends 'panel/base.html' %}

{% block content %}
<div style="margin-bottom: 2rem;">
    <a href="{% url 'project_detail' project.id %}" style="color: var(--text-secondary);">&larr; Back to Project</a>
</div>

<div class="glass-container" style="padding: 2rem;">
    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 2rem;">
        <h2 style="margin: 0;">File Explorer</h2>
        <span style="color: var(--text-secondary); font-size: 0.9rem;">{{ project.name }}</span>
    </div>

    <!-- Breadcrumbs -->
    <div style="background: rgba(255,255,255,0.05); padding: 0.75rem 1rem; border-radius: 6px; margin-bottom: 2rem; display: flex; gap: 0.5rem; color: var(--text-secondary);">
        <a href="{% url 'project_files' project.id %}" style="color: var(--accent-color);">root</a>
        {% for crumb in breadcrumbs %}
            <span>/</span>
            {% if forloop.last %}
                <span style="color: white;">{{ crumb.name }}</span>
            {% else %}
                <a href="{% url 'project_files' project.id %}?path={{ crumb.path }}" style="color: var(--accent-color);">{{ crumb.name }}</a>
            {% endif %}
        {% endfor %}
    </div>

    <!-- File List -->
    <div style="display: flex; flex-direction: column; gap: 0.5rem;">
        {% if current_path %}
        <a href="javascript:history.back()" style="display: flex; align-items: center; gap: 1rem; padding: 0.75rem; border-radius: 6px; color: var(--text-secondary); text-decoration: none; transition: background 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.05)'" onmouseout="this.style.background='transparent'">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 14 4 9 9 4"></polyline><path d="M20 20v-7a4 4 0 0 0-4-4H4"></path></svg>
            ..
        </a>
        {% endif %}

        {% for item in files %}
        <a href="{% if item.is_dir %}{% url 'project_files' project.id %}?path={{ item.path }}{% else %}{% url 'project_file_edit' project.id %}?path={{ item.path }}{% endif %}" 
           style="display: flex; align-items: center; justify-content: space-between; padding: 0.75rem; border-radius: 6px; color: var(--text-primary); text-decoration: none; transition: background 0.2s; border-bottom: 1px solid rgba(255,255,255,0.02);"
           onmouseover="this.style.background='rgba(255,255,255,0.05)'" onmouseout="this.style.background='transparent'">
            <div style="display: flex; align-items: center; gap: 1rem;">
                {% if item.is_dir %}
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#fbbf24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>
                    <span style="font-weight: 500;">{{ item.name }}</span>
                {% else %}
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="opacity: 0.5;"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg>
                    <span>{{ item.name }}</span>
                {% endif %}
            </div>
            {% if not item.is_dir %}
                <span style="color: var(--text-secondary); font-size: 0.85rem; font-family: monospace;">{{ item.size|filesizeformat }}</span>
            {% endif %}
        </a>
        {% empty %}
            <div style="padding: 2rem; text-align: center; color: var(--text-secondary);">Directory is empty</div>
        {% endfor %}
    </div>
</div>
{% endblock %}
